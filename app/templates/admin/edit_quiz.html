{% extends "base.html" %}
{% block title %}Edit Quiz: {{ quiz.title }}{% endblock %}
{% block content %}
<div class="card">
    <div class="card-content">
        <h2>Edit Quiz: {{ quiz.title }}</h2>
        <form method="POST" action="{{ url_for('admin.edit_quiz', quiz_id=quiz.id) }}">
            <div class="form-control">
                <label for="quizTitle">Quiz Title</label>
                <input type="text" id="quizTitle" name="title" class="form-control" value="{{ quiz.title }}" required>
            </div>
            <div class="form-control">
                <label for="quizDescription">Description</label>
                <textarea id="quizDescription" name="description" class="form-control description-textarea">{{ quiz.description or '' }}</textarea>
            </div>
            <div class="text-right mt-3">
                <button type="submit" class="btn btn-primary btn-sm">Save Quiz Details</button>
                <button type="button" class="btn btn-error btn-sm" onclick="deleteQuiz()">Delete Quiz</button>
            </div>
        </form>
    <h3>Questions</h3>
{% if questions %}
    <style>
        .quiz-table {
            width: 100%;
            table-layout: fixed;
        }
        .quiz-table th, .quiz-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--divider);
        }
        .quiz-table .col-order {
            width: 10%;
        }
        .quiz-table .col-text {
            width: auto;
            word-break: break-word;
            white-space: normal;
        }
        .quiz-table .col-actions {
            width: 20%;
            text-align: right;
        }
    </style>
    <table class="quiz-table">
        <thead>
            <tr>
                <th class="col-order">Order</th>
                <th class="col-text">Text</th>
                <th class="col-actions">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for q in questions %}
                <tr>
                    <td class="col-order">{{ q.order }}</td>
                    <td class="col-text">{{ q.text }}</td>
                    <td class="col-actions">
                        <a href="{{ url_for('admin.edit_question', quiz_id=quiz.id, question_order=q.order) }}" class="btn btn-primary btn-sm">Edit</a>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No questions yet.</p>
{% endif %}
<a href="{{ url_for('admin.edit_question', quiz_id=quiz.id, question_order=questions|length + 1) }}" class="btn btn-secondary mt-2">Add New Question</a>    
    
    </div>
</div>
<script>
    function deleteQuiz() {
        if (confirm('Are you sure you want to delete this quiz?')) {
            fetch('{{ url_for('admin.delete_quiz', quiz_id=quiz.id) }}', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    window.location.href = '{{ url_for('admin.dashboard') }}';
                } else {
                    alert(data.message || 'Error deleting quiz');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error deleting quiz');
            });
        }
    }
</script>
{% endblock %}