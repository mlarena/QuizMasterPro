Вопросы по файлам данных, слоям хранения и TOAST
1. Какой размер страницы (page) используется в PostgreSQL по умолчанию?
a) 8 KB
b) 16 KB
c) 4 KB
d) 32 KB
Правильный ответ: a

2. Что такое TOAST в PostgreSQL?
a) Механизм хранения больших атрибутов вне основной таблицы
b) Система сжатия всех данных таблицы
c) Метод шифрования больших объектов
d) Технология оптимизации запросов
Правильный ответ: a

3. Какой слой отвечает за отслеживание свободного места в страницах таблицы?
a) FSM (Free Space Map)
b) VM (Visibility Map)
c) TOAST
d) WAL
Правильный ответ: a

4. Что такое FSM в контексте хранения данных?
a) Карта свободного пространства для быстрого поиска места под новые версии строк
b) Файловая система менеджера
c) Карта файлового пространства
d) Система управления свободной памятью
Правильный ответ: a

5. При каком размере поля срабатывает механизм TOAST?
a) Обычно около 2 KB
b) 1 KB
c) 4 KB
d) 8 KB
Правильный ответ: a

6. Что такое VM (Visibility Map) в PostgreSQL?
a) Битовая карта страниц, где все кортежи видны всем транзакциям
b) Карта видимых данных для пользователей
c) Файл отображения видимости индексов
d) Система управления видимостью транзакций
Правильный ответ: a

7. Какие основные стратегии использует TOAST для хранения больших данных?
a) PLAIN, EXTENDED, EXTERNAL, MAIN
b) COMPRESS, ARCHIVE, EXTERNAL, INTERNAL
c) STORAGE, COMPACT, EXTERNAL, INTERNAL
d) PLAIN, COMPRESSED, EXTERNAL, INTERNAL
Правильный ответ: a

8. Какой формат хранения TOAST используется по умолчанию?
a) EXTENDED
b) PLAIN
c) EXTERNAL
d) MAIN
Правильный ответ: a

9. Что такое "версия строки" в контексте MVCC?
a) Отдельная копия строки для каждой транзакции, которая её изменяет
b) Номер версии данных в таблице
c) Метка времени изменения строки
d) Идентификатор последней операции с строкой
Правильный ответ: a

10. Как посмотреть TOAST-таблицу для основной таблицы?
a) SELECT reltoastrelid FROM pg_class WHERE relname = 'table_name'
b) SHOW TOAST TABLE FOR 'table_name'
c) \d+ table_name в psql (показывает TOAST-таблицу)
d) Оба варианта a и c верны
Правильный ответ: d

11. Что такое "мертвые" версии строк?
a) Версии строк, которые больше не видны ни одной транзакции
b) Строки с поврежденными данными
c) Строки, помеченные для удаления
d) Старые версии строк в TOAST-таблице
Правильный ответ: a

12. Какой процесс удаляет мертвые версии строк?
a) VACUUM
b) ANALYZE
c) CHECKPOINT
d) BACKGROUND WRITER
Правильный ответ: a

13. Что такое init fork в файлах данных таблицы?
a) Начальный фрагмент с bootstrap информацией таблицы
b) Файл инициализации табличного пространства
c) Начальный сегмент базы данных
d) Фрагмент инициализации индекса
Правильный ответ: a

14. Какой слой помогает VACUUM определить, какие страницы нужно обрабатывать?
a) Visibility Map (VM)
b) Free Space Map (FSM)
c) TOAST
d) Transaction Map
Правильный ответ: a

15. Что такое TOAST-идентификатор (TOAST pointer)?
a) Ссылка на данные в TOAST-таблице
b) Идентификатор стратегии TOAST
c) Указатель на сжатые данные
d) Индекс в TOAST-таблице
Правильный ответ: a

16. Какой формат хранения TOAST запрещает сжатие и внешнее хранение?
a) PLAIN
b) EXTENDED
c) EXTERNAL
d) MAIN
Правильный ответ: a

17. Что такое fork в контексте файлов данных?
a) Различные типы файлов данных для одной таблицы
b) Ветвление таблицы для партиционирования
c) Разделение данных между табличными пространствами
d) Копирование таблицы для репликации
Правильный ответ: a

18. Какой формат TOAST разрешает внешнее хранение, но запрещает сжатие?
a) EXTERNAL
b) EXTENDED
c) MAIN
d) PLAIN
Правильный ответ: a

19. Что такое relfilenode?
a) Идентификатор файла для отношения (таблицы/индекса)
b) Узел связанных файлов
c) Идентификатор файловой системы
d) Нод репликации файлов
Правильный ответ: a

20. Как посмотреть размер TOAST-таблицы?
a) SELECT pg_size_pretty(pg_relation_size(reltoastrelid)) FROM pg_class WHERE relname = 'table_name'
b) SHOW TOAST SIZE FOR 'table_name'
c) SELECT toast_size FROM pg_table_size WHERE tablename = 'table_name'
d) \d+ table_name в psql
Правильный ответ: a

21. Что такое "версионность строк" (row versioning) в MVCC?
a) Создание новых версий строк при изменении
b) Хранение истории изменений в отдельной таблице
c) Кэширование различных представлений данных
d) Шифрование версий данных
Правильный ответ: a

22. Какой формат TOAST пытается сначала сжать данные, а при неудаче сохраняет в TOAST-таблице?
a) MAIN
b) EXTENDED
c) EXTERNAL
d) PLAIN
Правильный ответ: a

23. Что такое "насыщение" (overcrowding) страницы?
a) Ситуация, когда страница заполнена разными версиями строк
b) Превышение максимального размера страницы
c) Переполнение TOAST-таблицы
d) Избыточное количество индексов на таблицу
Правильный ответ: a

24. Как VACUUM использует Free Space Map?
a) Для отслеживания страниц с достаточным свободным местом
b) Для определения страниц с мертвыми кортежами
c) Для оптимизации работы TOAST
d) Для управления версиями строк
Правильный ответ: a

25. Что такое TOAST-таблица?
a) Отдельная таблица для хранения больших атрибутов
b) Специальная системная таблица
c) Временная таблица для обработки больших данных
d) Таблица с метаданными TOAST
Правильный ответ: a

26. Какой системный столбец содержит идентификатор транзакции, создавшей версию строки?
a) xmin
b) xmax
c) cmin
d) cmax
Правильный ответ: a

27. Что происходит при обновлении строки с большим полем в режиме EXTENDED?
a) Создается новая версия строки с TOAST-указателем
b) Данные перезаписываются на месте
c) Создается новая TOAST-таблица
d) Данные автоматически сжимаются
Правильный ответ: a

28. Как Visibility Map ускоряет VACUUM?
a) Позволяет пропускать страницы без мертвых кортежей
b) Содержит карту версий строк
c) Оптимизирует работу с TOAST
d) Ускоряет поиск свободного места
Правильный ответ: a

29. Что такое "замороженная" (frozen) версия строки?
a) Версия, которая всегда видна всем транзакциям
b) Заблокированная для изменений строка
c) Строка в TOAST-таблице
d) Архивированная версия строки
Правильный ответ: a

30. Как установить стратегию хранения TOAST для столбца?
a) ALTER TABLE table_name ALTER COLUMN column_name SET STORAGE strategy
b) SET STORAGE strategy FOR COLUMN column_name IN TABLE table_name
c) MODIFY COLUMN column_name STORAGE strategy IN TABLE table_name
d) CHANGE COLUMN column_name STORAGE strategy IN TABLE table_name
Правильный ответ: a

31. Что такое "версионность индексов" в PostgreSQL?
a) Индексы содержат ссылки на все версии строк
b) Индексы тоже имеют версии
c) Индексы обновляются при создании новых версий строк
d) Индексы хранят историю изменений
Правильный ответ: a

32. Какой формат хранения TOAST наиболее эффективен для часто обновляемых больших данных?
a) EXTERNAL
b) EXTENDED
c) MAIN
d) PLAIN
Правильный ответ: a

33. Что такое "bloat" в контексте версионности строк?
a) Раздувание таблицы из-за накопления мертвых версий строк
b) Увеличение размера TOAST-таблицы
c) Фрагментация файлов данных
d) Избыточность в индексах
Правильный ответ: a

34. Как посмотреть количество живых и мертвых версий строк в таблице?
a) SELECT n_live_tup, n_dead_tup FROM pg_stat_user_tables WHERE relname = 'table_name'
b) SHOW LIVE AND DEAD TUPLES FOR 'table_name'
c) SELECT count(*) FROM table_name WHERE visible = true
d) \d+ table_name в psql
Правильный ответ: a

35. Что такое HOT (Heap-Only Tuple) update?
a) Обновление без изменения индексируемых полей, позволяющее повторно использовать пространство
b) Быстрое обновление через кэш
c) Обновление только в основной таблице без TOAST
d) Горячее обновление часто используемых строк
Правильный ответ: a

36. Какой слой помогает при вставке новых строк?
a) Free Space Map (FSM)
b) Visibility Map (VM)
c) TOAST
d) Transaction Map
Правильный ответ: a

37. Что происходит при удалении строки с TOAST-данными?
a) Удаляются и основная запись, и соответствующие записи в TOAST-таблице
b) Удаляется только основная запись
c) TOAST-данные архивируются
d) TOAST-данные остаются до явного удаления
Правильный ответ: a

38. Как VACUUM использует Visibility Map?
a) Для пропуска страниц, где все кортежи видны
b) Для поиска страниц с мертвыми кортежами
c) Для определения необходимости заморозки
d) Для оптимизации работы индексов
Правильный ответ: a

39. Что такое "версионность TOAST-данных"?
a) TOAST-данные тоже участвуют в MVCC
b) TOAST-таблица хранит историю изменений
c) TOAST-указатели имеют версии
d) TOAST-данные неизменяемы
Правильный ответ: a

40. Как определить, что таблица имеет проблемы с bloat?
a) Высокое отношение n_dead_tup к n_live_tup в pg_stat_user_tables
b) Большой размер TOAST-таблицы
c) Медленные запросы SELECT
d) Частые блокировки таблицы
Правильный ответ: a

41. Что такое "фрагментация" в контексте файлов данных?
a) Неэффективное распределение данных по страницам
b) Разбиение таблицы на части
c) Разделение данных между табличными пространствами
d) Потеря связи между версиями строк
Правильный ответ: a

42. Какой механизм помогает уменьшить bloat при обновлениях?
a) HOT updates
b) TOAST compression
c) FSM optimization
d) VM cleanup
Правильный ответ: a

43. Что такое "рециклинг" версий строк?
a) Повторное использование пространства мертвых версий для новых данных
b) Архивация старых версий
c) Восстановление удаленных версий
d) Миграция версий между таблицами
Правильный ответ: a

44. Как посмотреть стратегию хранения для столбцов таблицы?
a) \d+ table_name в psql
b) SHOW COLUMN STORAGE FOR table_name
c) SELECT attname, attstorage FROM pg_attribute WHERE attrelid = 'table_name'::regclass
d) Оба варианта a и c верны
Правильный ответ: d

45. Что такое "агрессивный" VACUUM?
a) VACUUM с более тщательной обработкой для предотвращения wraparound
b) VACUUM с принудительной блокировкой таблицы
c) VACUUM только для больших таблиц
d) VACUUM с оптимизацией TOAST
Правильный ответ: a

46. Как TOAST влияет на производительность?
a) Уменьшает размер основной таблицы, но может замедлить доступ к большим данным
b) Всегда ускоряет все операции
c) Замедляет вставки, но ускоряет выборки
d) Не влияет на производительность
Правильный ответ: a

47. Что такое "кортеж" (tuple) в контексте PostgreSQL?
a) Версия строки в таблице
b) Запись в TOAST-таблице
c) Элемент массива данных
d) Блок информации в странице
Правильный ответ: a

48. Как определить размер всех TOAST-таблиц в базе данных?
a) SELECT sum(pg_relation_size(reltoastrelid)) FROM pg_class WHERE reltoastrelid != 0
b) SHOW TOTAL TOAST SIZE
c) SELECT pg_total_toast_size()
d) \dt+ в psql
Правильный ответ: a

49. Что такое "inline" хранение в контексте TOAST?
a) Хранение данных непосредственно в основной таблице
b) Хранение в отдельном файле
c) Хранение в сжатом виде
d) Хранение в оперативной памяти
Правильный ответ: a

50. Какой параметр управляет порогом срабатывания TOAST?
a) toast_tuple_target
b) toast_threshold
c) toast_size_limit
d) large_object_threshold
Правильный ответ: a

