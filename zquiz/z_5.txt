Вопросы по транзакциям, уровням изоляции и блокировкам
1. Какой уровень изоляции транзакций в PostgreSQL обеспечивает наивысшую согласованность данных?
a) Read uncommitted
b) Read committed
c) Repeatable read
d) Serializable
Правильный ответ: d

2. Что такое "грязное чтение" (dirty read)?
a) Чтение данных, удаленных другой транзакцией
b) Чтение незакоммиченных данных другой транзакции
c) Чтение данных, измененных текущей транзакцией
d) Чтение устаревших данных из кэша
Правильный ответ: b

3. Какой уровень изоляции предотвращает "неповторяющееся чтение" (non-repeatable read) в PostgreSQL?
a) Read uncommitted
b) Read committed
c) Repeatable read
d) Все перечисленные
Правильный ответ: c

4. Что такое "фантомное чтение" (phantom read)?
a) Появление новых строк при повторном чтении
b) Исчезновение строк при повторном чтении
c) Изменение существующих строк при повторном чтении
d) Чтение несуществующих данных
Правильный ответ: a

5. Какой командой начинается транзакция в PostgreSQL?
a) START TRANSACTION
b) BEGIN
c) BEGIN TRANSACTION
d) Любой из перечисленных
Правильный ответ: d

6. Что происходит при выполнении COMMIT в транзакции?
a) Все изменения сохраняются постоянно
b) Транзакция откатывается
c) Снимаются все блокировки
d) Варианты a и c
Правильный ответ: d

7. Какая команда создает точку сохранения (savepoint) в транзакции?
a) CREATE SAVEPOINT
b) SAVEPOINT
c) SET SAVEPOINT
d) MARK SAVEPOINT
Правильный ответ: b

8. Как откатиться к точке сохранения с именем "my_savepoint"?
a) ROLLBACK TO my_savepoint
b) ROLLBACK SAVEPOINT my_savepoint
c) REVERT TO my_savepoint
d) UNDO TO my_savepoint
Правильный ответ: a

9. Что такое "взаимоблокировка" (deadlock)?
a) Транзакция ожидает саму себя
b) Две или более транзакций ожидают друг друга
c) Транзакция занимает все ресурсы системы
d) Бесконечное выполнение транзакции
Правильный ответ: b

10. Как PostgreSQL обрабатывает взаимоблокировки?
a) Прерывает все участвующие транзакции
b) Прерывает одну из транзакций (жертву)
c) Ждет неограниченное время
d) Автоматически разрешает конфликт
Правильный ответ: b

11. Какой параметр определяет время ожидания блокировки перед проверкой на взаимоблокировку?
a) lock_timeout
b) deadlock_timeout
c) statement_timeout
d) idle_in_transaction_session_timeout
Правильный ответ: b

12. Какая системная функция показывает текущие блокировки?
a) pg_locks
b) pg_blocking_pids
c) pg_stat_activity
d) pg_transaction_locks
Правильный ответ: a

13. Как найти процессы, которые блокируют текущую транзакцию?
a) SELECT pg_blocking_pids(pg_backend_pid())
b) SELECT * FROM pg_locks WHERE granted = false
c) SELECT pid FROM pg_stat_activity WHERE waiting = true
d) Все варианты верны
Правильный ответ: a

14. Что такое "версионность строк" (MVCC) в PostgreSQL?
a) Механизм блокировок на уровне строк
b) Механизм создания версий строк для каждой транзакции
c) Система кэширования часто изменяемых данных
d) Метод сжатия данных
Правильный ответ: b

15. Какой уровень изоляции используется в PostgreSQL по умолчанию?
a) Read uncommitted
b) Read committed
c) Repeatable read
d) Serializable
Правильный ответ: b

16. Что происходит при конфликте сериализации в уровне изоляции Serializable?
a) Транзакция автоматически перезапускается
b) Возникает ошибка "could not serialize access"
c) Транзакция ожидает завершения конфликтующей транзакции
d) Конфликт игнорируется
Правильный ответ: b

17. Какая блокировка используется при операции SELECT?
a) AccessShareLock
b) RowShareLock
c) ShareLock
d) ExclusiveLock
Правильный ответ: a

18. Какая блокировка используется при операции UPDATE?
a) RowExclusiveLock
b) ExclusiveLock
c) ShareRowExclusiveLock
d) AccessExclusiveLock
Правильный ответ: a

19. Какая операция требует AccessExclusiveLock?
a) SELECT
b) UPDATE
c) DELETE
d) DROP TABLE
Правильный ответ: d

20. Что такое "ожидание блокировки" (lock waiting)?
a) Транзакция завершена, но блокировки не сняты
b) Транзакция не может получить требуемую блокировку
c) Система ожидает освобождения памяти
d) Ожидание завершения I/O операций
Правильный ответ: b

21. Как установить уровень изоляции для текущей транзакции?
a) SET TRANSACTION ISOLATION LEVEL ...
b) SET isolation_level = ...
c) BEGIN ISOLATION LEVEL ...
d) Варианты a и c
Правильный ответ: d

22. Что означает "неповторяющееся чтение" (non-repeatable read)?
a) Разные результаты при повторном чтении тех же данных
b) Чтение данных, которых больше не существует
c) Появление новых строк при повторном запросе
d) Чтение незакоммиченных данных
Правильный ответ: a

23. Какой уровень изоляции предотвращает фантомное чтение в PostgreSQL?
a) Read committed
b) Repeatable read
c) Serializable
d) Варианты b и c
Правильный ответ: d

24. Что такое "синтаксис двухфазного коммита" (2PC)?
a) PREPARE TRANSACTION и COMMIT PREPARED
b) BEGIN TRANSACTION и END TRANSACTION
c) START TRANSACTION и FINISH TRANSACTION
d) CREATE TRANSACTION и DESTROY TRANSACTION
Правильный ответ: a

25. Для чего используется PREPARE TRANSACTION?
a) Для подготовки транзакции к откату
b) Для подготовки распределенной транзакции к коммиту
c) Для создания точки сохранения
d) Для оптимизации выполнения транзакции
Правильный ответ: b

26. Какая системная функция показывает подготовленные транзакции?
a) pg_prepared_transactions
b) pg_prepared_xacts
c) pg_transaction_status
d) pg_stat_transactions
Правильный ответ: b

27. Что происходит с блокировками при ROLLBACK?
a) Все блокировки сохраняются
b) Все блокировки снимаются
c) Только эксклюзивные блокировки снимаются
d) Блокировки снимаются через deadlock_timeout
Правильный ответ: b

28. Какой параметр ограничивает время выполнения отдельного SQL-запроса?
a) statement_timeout
b) lock_timeout
c) deadlock_timeout
d) idle_in_transaction_session_timeout
Правильный ответ: a

29. Что делает параметр lock_timeout?
a) Ограничивает время ожидания блокировки
b) Ограничивает время удержания блокировки
c) Определяет интервал проверки взаимоблокировок
d) Ограничивает время выполнения транзакции
Правильный ответ: a

30. Как посмотреть текущий уровень изоляции транзакции?
a) SHOW transaction_isolation
b) SELECT current_setting('transaction_isolation')
c) Оба варианта верны
d) Невозможно посмотреть
Правильный ответ: c

31. Что такое "сохранение уровня изоляции" (isolation level preservation)?
a) Уровень изоляции нельзя изменить после начала транзакции
b) Уровень изоляции автоматически повышается при конфликтах
c) Уровень изоляции наследуется от родительской транзакции
d) Уровень изоляции сохраняется между сессиями
Правильный ответ: a

32. Какая блокировка конфликтует с AccessExclusiveLock?
a) Все блокировки
b) Только AccessShareLock
c) Только ExclusiveLock
d) Только ShareLock
Правильный ответ: a

33. Как избежать взаимоблокировки при обновлении нескольких строк в разных таблицах?
a) Всегда обновлять таблицы в одинаковом порядке
b) Использовать более высокий уровень изоляции
c) Увеличить deadlock_timeout
d) Использовать NOWAIT в запросах
Правильный ответ: a

34. Что такое "sequential number" в контексте транзакций?
a) Идентификатор транзакции (xid)
b) Номер строки в таблице
c) Номер блока данных
d) Номер контрольной точки
Правильный ответ: a

35. Как посмотреть идентификатор текущей транзакции?
a) SELECT txid_current()
b) SELECT pg_current_xact_id()
c) Оба варианта верны
d) Невозможно посмотреть
Правильный ответ: c

36. Что означает "xmin" и "xmax" в системных колонках?
a) Минимальная и максимальная версия строки
b) Идентификаторы транзакций, создавшей и удалившей строку
c) Время создания и удаления строки
d) Размер строки в байтах
Правильный ответ: b

37. Какой уровень изоляции использует "snapshot isolation"?
a) Read committed
b) Repeatable read
c) Serializable
d) Read uncommitted
Правильный ответ: b

38. Что такое "синхронная фиксация" (synchronous commit)?
a) Немедленная запись WAL на диск при COMMIT
b) Ожидание подтверждения от реплики
c) Синхронное выполнение всех операций
d) Автоматический коммит после каждого запроса
Правильный ответ: a

39. Как установить режим ожидания блокировки NOWAIT?
a) SELECT ... FOR UPDATE NOWAIT
b) SET lock_wait = 'nowait'
c) BEGIN NOWAIT
d) LOCK TABLE ... NOWAIT
Правильный ответ: a

40. Что происходит при использовании NOWAIT и невозможности немедленно получить блокировку?
a) Транзакция ожидает deadlock_timeout
b) Возникает ошибка
c) Транзакция переходит в режим ожидания
d) Запрос пропускается
Правильный ответ: b

41. Какой командой можно явно заблокировать таблицу?
a) LOCK TABLE
b) BLOCK TABLE
c) HOLD TABLE
d) GRAB TABLE
Правильный ответ: a

42. Какие режимы блокировки таблиц существуют в PostgreSQL?
a) ACCESS SHARE, ROW SHARE, ROW EXCLUSIVE
b) SHARE UPDATE EXCLUSIVE, SHARE, SHARE ROW EXCLUSIVE
c) EXCLUSIVE, ACCESS EXCLUSIVE
d) Все перечисленные
Правильный ответ: d

43. Что такое "predicate locking" в уровне изоляции Serializable?
a) Блокировка условий запроса для предотвращения фантомного чтения
b) Блокировка на основе предикатов индекса
c) Условная блокировка строк
d) Блокировка только удовлетворяющих условию строк
Правильный ответ: a

44. Как посмотреть длительность текущей транзакции?
a) SELECT now() - xact_start FROM pg_stat_activity WHERE pid = pg_backend_pid()
b) SELECT pg_transaction_duration()
c) SHOW transaction_duration
d) Невозможно посмотреть
Правильный ответ: a

45. Что такое "subtransactions" и когда они используются?
a) Вложенные транзакции через savepoints
b) Распределенные транзакции
c) Параллельные транзакции
d) Мини-транзакции внутри одной операции
Правильный ответ: a

46. Как ограничить время простоя транзакции?
a) idle_in_transaction_session_timeout
b) statement_timeout
c) lock_timeout
d) transaction_timeout
Правильный ответ: a

47. Что происходит при достижении idle_in_transaction_session_timeout?
a) Транзакция автоматически коммитится
b) Транзакция автоматически откатывается
c) Сессия завершается
d) Возникает предупреждение
Правильный ответ: b

48. Какой уровень изоляции наиболее производительный для операций чтения?
a) Read uncommitted
b) Read committed
c) Repeatable read
d) Serializable
Правильный ответ: b

49. Что такое "transaction wraparound" и как его предотвратить?
a) Переполнение идентификаторов транзакций, предотвращается VACUUM
b) Циклическое выполнение транзакций, предотвращается ограничением глубины
c) Зацикливание транзакций, предотвращается deadlock detection
d) Потеря данных транзакции, предотвращается синхронной репликацией
Правильный ответ: a

50. Как мониторить активные транзакции и их блокировки?
a) pg_stat_activity + pg_locks
b) pg_transaction_info
c) pg_monitor_transactions
d) SHOW active_transactions
Правильный ответ: a