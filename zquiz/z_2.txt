Экспертные вопросы по администрированию PostgreSQL
1. Какая системная функция позволяет безопасно изменять значения параметров конфигурации только для текущей транзакции?
a) SET LOCAL
b) SET SESSION
c) pg_set_transaction_config()
d) SET TRANSACTION PARAMETER
Правильный ответ: a

2. Что произойдет, если выполнить VACUUM FREEZE на таблице с отключенным autovacuum_freeze_max_age?
a) Это ускорит обычную очистку
b) Это предотвратит wraparound для всей таблицы
c) Это вызовет ошибку, так параметр нельзя отключить
d) Это приведет к принудительному autovacuum
Правильный ответ: b

3. Какой механизм обеспечивает сериализацию транзакций в PostgreSQL?
a) MVCC (Multi-Version Concurrency Control)
b) SSI (Serializable Snapshot Isolation)
c) Two-Phase Locking
d) OCC (Optimistic Concurrency Control)
Правильный ответ: b

4. Что происходит при достижении max_worker_processes в системе с интенсивной параллельной обработкой?
a) PostgreSQL автоматически увеличивает лимит
b) Новые фоновые процессы становятся в очередь
c) Запросы получают ошибку "out of background workers"
d) Сервер переходит в режим read-only
Правильный ответ: c

5. Как эффективно обнаружить "bloat" (раздувание) индексов без использования расширений?
a) SELECT pg_stat_all_indexes.idx_bloat_ratio
b) EXPLAIN (ANALYZE, BUFFERS)
c) Сравнение pg_class.relpages с ожидаемым размером
d) VACUUM (VERBOSE) table_name
Правильный ответ: c

6. Какая особенность JIT-компиляции в PostgreSQL требует особого внимания при настройке памяти?
a) jit_above_cost должен быть равен 0
b) Использование work_mem для JIT-операций
c) Отдельное выделение памяти через jit_buffer_size
d) JIT не использует дополнительную память
Правильный ответ: c

7. Что делает параметр vacuum_failsafe_age?
a) Запускает экстренный VACUUM при нехватке памяти
b) Активирует аварийную очистку при приближении к wraparound
c) Останавливает autovacuum при частых ошибках
d) Включает резервный режим VACUUM
Правильный ответ: b

8. Какой метод обеспечивает наименьшую вероятность конфликта при логической репликации больших таблиц?
a) Репликация через SSL
b) Использование COPY данных перед созданием подписки
c) Увеличение max_replication_slots
d) Настройка synchronous_commit = remote_apply
Правильный ответ: b

9. Что происходит при сбое диска во время выполнения CREATE DATABASE с параметром STRATEGY = WAL_LOG?
a) База данных создается неполностью и требует ручного вмешательства
b) Транзакция откатывается автоматически
c) Процесс завершается аварийно, требуется pg_resetwal
d) Создается база-заглушка для последующего восстановления
Правильный ответ: b

10. Какая команда позволяет безопасно остановить репликацию без потери данных?
a) ALTER SYSTEM SET primary_conninfo = ''
b) pg_ctl promote
c) SELECT pg_stop_replication()
d) DROP_REPLICATION_SLOT
Правильный ответ: b

11. Как настроить ограничение на использование CPU для конкретной базы данных?
a) Через ALTER DATABASE SET cpu_limit = ...
b) Средствами операционной системы (cgroups)
c) Через pg_resource_manager
d) В PostgreSQL нет встроенного ограничения CPU
Правильный ответ: d

12. Что происходит при достижении max_slot_wal_keep_size?
a) Репликация переключается в асинхронный режим
b) Слот репликации автоматически удаляется
c) WAL-файлы начинают циклически перезаписываться
d) Репликация останавливается до ручного вмешательства
Правильный ответ: c

13. Какой параметр критически важен для предотвращения паники при wraparound в системах с долгими транзакциями?
a) autovacuum_naptime = 1
b) old_snapshot_threshold
c) vacuum_defer_cleanup_age
d) idle_in_transaction_session_timeout
Правильный ответ: d

14. Что делает расширение pg_prewarm в режиме auto?
a) Автоматически загружает все индексы в кэш
b) Сохраняет состояние кэша между перезагрузками
c) Предзагружает данные при первом обращении
d) Автоматически определяет "горячие" таблицы
Правильный ответ: b

15. Как эффективно обновить статистику для большой таблицы без блокировки?
a) ANALYZE NONBLOCKING table_name
b) Увеличить default_statistics_target и запустить ANALYZE
c) Использовать CREATE STATISTICS с большей выборкой
d) Нет неблокирующего способа, только увеличение скорости через параллелизм
Правильный ответ: d

16. Какая особенность работы REINDEX CONCURRENTLY может привести к деградации производительности?
a) Создание временной копии индекса
b) Использование дополнительной work_mem
c) Блокировка таблицы на финальной стадии
d) Удвоенное место на диске и нагрузка на I/O
Правильный ответ: d

17. Что происходит при выполнении TRUNCATE на таблице с внешними ключами без CASCADE?
a) Операция завершается ошибкой
b) Внешние ключи автоматически отключаются
c) Таблица очищается, а связанные таблицы помечаются для VACUUM
d) Создается точка сохранения для возможного отката
Правильный ответ: a

18. Как настроить разные значения work_mem для разных пользователей?
a) ALTER USER SET work_mem = ...
b) SET ROLE work_mem = ...
c) Через параметры в pg_hba.conf
d) В postgresql.conf с условиями
Правильный ответ: a

19. Что такое "HOT update" (Heap-Only Tuple) и когда он не работает?
a) Обновление без изменения индексов, не работает при изменении индексируемых полей
b) Быстрое обновление через кэш, не работает при нехватке памяти
c) Параллельное обновление, не работает в репликах
d) Атомарное обновление, не работает в транзакциях
Правильный ответ: a

20. Какой метод обеспечивает наиболее надежное восстановление после сбоя реплики?
a) pg_rewind
b) Ручное копирование WAL-файлов
c) Полное пересоздание реплики через pg_basebackup
d) Использование rsync для дифференциального копирования
Правильный ответ: a

21. Что происходит при достижении max_prepared_transactions в системе с двухфазными коммитами?
a) Транзакции автоматически откатываются
b) Новые prepared transactions получают ошибку
c) Система переходит к однофазным коммитам
d) Лимит автоматически увеличивается
Правильный ответ: b

22. Как эффективно мониторить прогресс выполнения CREATE INDEX CONCURRENTLY?
a) SELECT * FROM pg_stat_progress_create_index
b) Через лог-файлы с включенным log_lock_waits
c) pg_stat_activity с фильтром по команде
d) Напрямую через системные вызовы
Правильный ответ: a

23. Что делает параметр wal_compression и когда его стоит включать?
a) Сжимает WAL-файлы, всегда включать для экономии места
b) Сжимает полные страницы в WAL, включать при частых обновлениях одних и тех же страниц
c) Сжимает архивные WAL-файлы, включать при медленном сетевом соединении
d) Сжимает данные в репликации, включать при ограниченной пропускной способности
Правильный ответ: b

24. Как настроить разные уровни изоляции для разных транзакций в одном соединении?
a) SET TRANSACTION ISOLATION LEVEL ...
b) ALTER DATABASE SET default_transaction_isolation = ...
c) Через параметры в connection string
d) В postgresql.conf для конкретной базы
Правильный ответ: a

25. Что происходит при сбое во выполнения DROP DATABASE?
a) База данных помечается для удаления при следующем запуске
b) Транзакция откатывается, база сохраняется
c) Создается резервная копия автоматически
d) Требуется ручное восстановление из WAL
Правильный ответ: a

26. Какой механизм обеспечивает защиту от "halloween problem" в PostgreSQL?
a) MVCC с версионированием строк
b) Tid scan вместо последовательного сканирования
c) Использование CTID для отслеживания перемещений
d) Автоматическое создание временных таблиц
Правильный ответ: c

27. Что делает параметр commit_delay и когда его использование оправдано?
a) Задержка коммита для группировки WAL-записей, при высокой нагрузке на I/O
b) Отложенный коммит для отладки, в тестовых средах
c) Задержка для синхронной репликации, при медленных репликах
d) Ожидание освобождения блокировок, при конкурентных транзакциях
Правильный ответ: a

28. Как эффективно обновить большую таблицу с минимальной блокировкой?
a) Использовать UPDATE ... FROM с подзапросом
b) Разбить на пакеты с LIMIT и ctid
c) Создать новую таблицу и заменить через ALTER TABLE ... RENAME
d) Использовать логическую репликацию для обновления на реплике
Правильный ответ: c

29. Что происходит при выполнении VACUUM FULL на таблице с активными транзакциями?
a) Операция блокируется до завершения транзакций
b) VACUUM FULL выполняется в неблокирующем режиме
c) Активные транзакции принудительно завершаются
d) Создается временная копия таблицы
Правильный ответ: a

30. Как настроить мониторинг самых медленных запросов в реальном времени?
a) Включить pg_stat_statements и настроить track_activity_query_size
b) Использовать auto_explain с log_min_duration_statement
c) Настроить логирование через log_statement = all
d) Запускать периодически EXPLAIN ANALYZE для частых запросов
Правильный ответ: a

31. Что такое "snapshot too old" ошибка и как ее предотвратить?
a) Нехватка памяти для снимков, увеличить work_mem
b) Долгие транзакции блокируют очистку, настроить old_snapshot_threshold
c) Переполнение WAL, увеличить max_wal_size
d) Конфликт версий, запустить VACUUM FREEZE
Правильный ответ: b

32. Как эффективно выполнить массовую загрузку данных с минимальным impact на производительность?
a) Использовать INSERT ... VALUES с множественными строками
b) COPY с отключением autovacuum и индексов
c) pg_bulkload расширение
d) Логическая репликация из временной базы
Правильный ответ: b

33. Что происходит при достижении max_locks_per_transaction?
a) Транзакция получает ошибку "out of locks"
b) PostgreSQL автоматически увеличивает лимит
c) Начинается принудительный VACUUM
d) Система переходит в режим read-only
Правильный ответ: a

34. Как настроить географически распределенную репликацию с минимальной задержкой?
a) Использовать синхронную репликацию с synchronous_commit = remote_apply
b) Увеличить wal_sender_timeout и wal_receiver_timeout
c) Настроить логическую репликацию с компрессией
d) Использовать каскадную репликацию через промежуточный узел
Правильный ответ: c

35. Что делает параметр enable_partitionwise_join и когда его включать?
a) Включает объединение по партициям, при одинаковой структуре партиций
b) Разрешает JOIN между партициями, всегда включать
c) Оптимизирует JOIN для партиционированных таблиц, при большом количестве партиций
d) Включает параллельные JOIN, для систем с множеством CPU
Правильный ответ: a

36. Как эффективно обнаружить и устранить "freeze storm"?
a) Увеличить autovacuum_freeze_max_age и запустить VACUUM FREEZE вручную
b) Настроить агрессивный autovacuum для всех таблиц
c) Отключить autovacuum и выполнять VACUUM по расписанию
d) Увеличить vacuum_freeze_min_age для редких freeze
Правильный ответ: a

37. Что происходит при сбое реплики во время применения WAL?
a) Реплика автоматически перезапускается с последней контрольной точки
b) Требуется ручное вмешательство для восстановления
c) Реплика переходит в режим "catchup" и догоняет мастер
d) Зависит от настроек wal_receiver_status_interval
Правильный ответ: a

38. Как настроить ограничение на количество соединений для конкретного пользователя?
a) ALTER USER user_name CONNECTION LIMIT N
b) Через pg_hba.conf с параметром connlimit
c) В postgresql.conf с условиями
d) Средствами пулера соединений (pgbouncer)
Правильный ответ: a

39. Что такое "plan cache invalidation" и когда оно происходит?
a) Сброс кэша планов при изменении статистики, после ANALYZE
b) Очистка кэша при нехватке памяти, при достижении shared_buffers
c) Принудительный пересчет планов при изменении схемы, после DDL
d) Автоматическая оптимизация планов, при изменении данных
Правильный ответ: c

40. Как эффективно выполнить миграцию с обновлением мажорной версии PostgreSQL?
a) pg_dump / pg_restore
b) Логическая репликация
c) pg_upgrade с параметром --link
d) Файловое копирование с pg_resetwal
Правильный ответ: c

41. Что происходит при достижении max_parallel_workers?
a) Параллельные запросы выполняются последовательно
b) Новые параллельные workers становятся в очередь
c) Запросы получают ошибку "out of parallel workers"
d) Система автоматически увеличивает лимит
Правильный ответ: a

42. Как настроить мониторинг блокировок в реальном времени с идентификацией блокирующих запросов?
a) Использовать pg_locks с JOIN к pg_stat_activity
b) Включить deadlock_timeout с логированием
c) Настроить log_lock_waits с log_min_duration_statement
d) Использовать расширение pg_blocking_pids
Правильный ответ: a

43. Что делает параметр default_toast_compression и когда его менять?
a) Выбор алгоритма сжатия TOAST, для оптимизации места на диске
b) Включение сжатия по умолчанию, всегда использовать LZ4
c) Настройка уровня сжатия, для баланса между CPU и I/O
d) Управление сжатием в репликации, для экономии трафика
Правильный ответ: a

44. Как эффективно выполнить обслуживание индексов GIN для полнотекстового поиска?
a) REINDEX CONCURRENTLY с параметром gin_pending_list_limit
b) VACUUM с полным сканированием
c) ANALYZE для обновления статистики
d) Использование gin_clean_pending_list()
Правильный ответ: a

45. Что происходит при выполнении ALTER TABLE ... ADD COLUMN с значением по умолчанию для большой таблицы?
a) Таблица переписывается полностью, длительная блокировка
b) Добавляется системный столбец, обновление при обращении
c) Создается новая таблица с копированием данных
d) Изменение применяется только к метаданным
Правильный ответ: a

46. Как настроить автоматическое переключение на реплику при сбое мастера?
a) Средствами PostgreSQL без дополнительных инструментов
b) Использовать pg_auto_failover или Patroni
c) Настроить trigger_file в recovery.conf
d) Через каскадную репликацию с автопромоутом
Правильный ответ: b

47. Что такое "incremental sort" и когда он используется?
a) Постепенная сортировка при наличии префикса индекса, для оптимизации с LIMIT
b) Сортировка небольшими порциями, при нехватке work_mem
c) Параллельная сортировка, при включенном parallel_leader_participation
d) Ленивая сортировка, для экономии CPU
Правильный ответ: a

48. Как эффективно мониторить использование временных файлов?
a) SELECT * FROM pg_stat_database WHERE datname = ...
b) Включить log_temp_files и анализировать логи
c) Мониторинг pg_stat_activity.temp_files и temp_bytes
d) Использовать pg_stat_statements с временными файлами
Правильный ответ: b

49. Что происходит при достижении max_files_per_process?
a) Процесс PostgreSQL завершается аварийно
b) Новые файлы открываются в режиме read-only
c) Операции с файлами получают ошибку "too many open files"
d) PostgreSQL автоматически увеличивает лимит через ulimit
Правильный ответ: c

50. Как настроить безопасное удаление чувствительных данных из WAL-файлов?
a) Использовать pg_cryptolog расширение
b) Настроить wal_log_hints = off
c) Включить wal_compression для шифрования
d) Невозможно, требуется использование внешнего шифрования
Правильный ответ: d